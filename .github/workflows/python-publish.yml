
name: Upload Python Package

on:
  push:
    tags: [ "v*" ]
  workflow_dispatch:


permissions:
  contents: write
  discussions: write

jobs:
  build:
    runs-on: macos-latest
    steps:
    - uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: latest-stable
    
    - uses: actions/checkout@v4
    - name: Install dependencies
      run: |
        brew install pyenv
        export PATH="$HOME/.pyenv/bin:$PATH"
        eval "$(pyenv init --path)"
        eval "$(pyenv virtualenv-init -)"
        # source ~/.bashrc
        pyenv install 3.8.10
        pyenv global 3.8.10
        echo "================="
        python --version
        echo "================="
        python -m pip install --upgrade pip
        pip install buildozer
        pip install kivy
        pip install kivymd
        pip install Cython==0.29.33
        pip list -v
        
    - name: generate dmg
      run: |
        buildozer -v osx debug


